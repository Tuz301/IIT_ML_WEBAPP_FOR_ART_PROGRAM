# =============================================================================
# IIT ML Service - Production Environment Configuration
# =============================================================================
# IMPORTANT: Keep this file secure and never commit to version control
# Copy this to .env for use in production
# =============================================================================

# =============================================================================
# API Configuration
# =============================================================================
API_TITLE=IIT Prediction ML Service
API_VERSION=1.0.0
DEBUG=false
ENVIRONMENT=production

# =============================================================================
# HTTPS/SSL Configuration
# =============================================================================
FORCE_HTTPS=true
HTTPS_PORT=443
HTTPS_STRICT=false
SSL_CERT_PATH=/etc/ssl/certs/cert.pem
SSL_KEY_PATH=/etc/ssl/private/key.pem

# =============================================================================
# Database Configuration (PostgreSQL for Production)
# =============================================================================
USE_POSTGRES=true
# SQLite fallback (for development only)
DATABASE_PATH=./iit_ml_service.db

# PostgreSQL Production Settings
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_DB=iit_ml_service
POSTGRES_USER=ml_service_user
POSTGRES_PASSWORD=CHANGE_THIS_STRONG_PASSWORD_IN_PRODUCTION
POSTGRES_POOL_SIZE=20
POSTGRES_MAX_OVERFLOW=40
POSTGRES_POOL_TIMEOUT=30
POSTGRES_POOL_RECYCLE=3600

# Additional Databases
IIT_DB_NAME=iit_db
IIT_DB_USER=iit_user
IIT_DB_PASSWORD=CHANGE_THIS_STRONG_PASSWORD_IN_PRODUCTION
MEDICAL_DB_NAME=medical_records

# =============================================================================
# Redis Configuration
# =============================================================================
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=
REDIS_MAX_CONNECTIONS=50
FEATURE_STORE_TTL=86400

# =============================================================================
# Security Configuration
# =============================================================================
# Strong JWT Secret (generate with: python -c "import secrets; print(secrets.token_urlsafe(32))")
SECRET_KEY=lSkMQjwuQCf1ut66y1uF43uP4O0SEq3WvB7W-2Cr_vw
JWT_SECRET_KEY=ParVHg0yhFaVpPnRZOZ6RMrgdjj4DxJ8Tpkl1aEWDjM
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7

# Cookie Settings (HTTPS required)
COOKIE_SECURE=true
COOKIE_SAMESITE=strict
COOKIE_DOMAIN=.yourdomain.com

# =============================================================================
# CORS Settings (Production Domain)
# =============================================================================
# UPDATE WITH YOUR PRODUCTION DOMAIN
CORS_ORIGINS=["https://yourdomain.com","https://www.yourdomain.com","https://api.yourdomain.com"]
FRONTEND_URL=https://yourdomain.com

# =============================================================================
# Rate Limiting (Public Endpoints)
# =============================================================================
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS=100
RATE_LIMIT_WINDOW=60
RATE_LIMIT_PER_USER=true

# =============================================================================
# Model Configuration
# =============================================================================
MODEL_PATH=./models/iit_lightgbm_model.txt
PREPROCESSING_PATH=./models/preprocessing_meta.joblib
MODEL_MANIFEST_PATH=./models/model_manifest.json
MODEL_VERSION=1.0.0
MODEL_RELOAD_INTERVAL=3600

# =============================================================================
# Performance Configuration
# =============================================================================
MAX_BATCH_SIZE=100
PREDICTION_TIMEOUT=30.0
MAX_WORKERS=4
WORKER_TIMEOUT=120

# =============================================================================
# Caching Configuration
# =============================================================================
CACHE_ENABLED=true
CACHE_TTL=300
CACHE_MAX_SIZE=1000

# =============================================================================
# Logging Configuration (Production)
# =============================================================================
LOG_LEVEL=INFO
LOG_FORMAT=json
LOG_FILE_PATH=./logs/iit_ml_service.log
LOG_ROTATION=50 MB
LOG_RETENTION=30 days

# =============================================================================
# Monitoring Configuration
# =============================================================================
METRICS_ENABLED=true
METRICS_PORT=9090
HEALTH_CHECK_INTERVAL=30

# =============================================================================
# OpenTelemetry / Distributed Tracing
# =============================================================================
TELEMETRY_ENABLED=true
JAEGER_ENDPOINT=http://jaeger:14268/api/traces
TELEMETRY_SAMPLE_RATE=0.1  # Sample 10% of requests in production
TELEMETRY_CONSOLE_EXPORT=false

# =============================================================================
# Alerting Configuration
# =============================================================================
# PagerDuty
ALERT_PAGERDUTY_ENABLED=true
ALERT_PAGERDUTY_KEY=your_pagerduty_integration_key
ALERT_PAGERDUTY_SEVERITY_THRESHOLD=error

# Slack
ALERT_SLACK_ENABLED=true
ALERT_SLACK_WEBHOOK=https://hooks.slack.com/services/YOUR/WEBHOOK/URL
ALERT_SLACK_CHANNEL=#alerts

# =============================================================================
# External Services
# =============================================================================
# OpenMRS EHR Integration
OPENMRS_API_URL=https://openmrs.yourdomain.com
OPENMRS_API_KEY=your_openmrs_api_key
OPENMRS_TIMEOUT=30

# =============================================================================
# Multi-Tenancy Configuration
# =============================================================================
MULTI_TENANCY_ENABLED=true
DEFAULT_TENANT_ID=default
TENANT_ISOLATION_LEVEL=database

# =============================================================================
# Backup Configuration
# =============================================================================
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *  # Daily at 2 AM
BACKUP_RETENTION_DAYS=30
BACKUP_PATH=./backups

# =============================================================================
# Circuit Breaker Configuration
# =============================================================================
CIRCUIT_BREAKER_ENABLED=true
CIRCUIT_BREAKER_FAILURE_THRESHOLD=5
CIRCUIT_BREAKER_TIMEOUT=60
CIRCUIT_BREAKER_SUCCESS_THRESHOLD=2

# =============================================================================
# Idempotency Configuration
# =============================================================================
IDEMPOTENCY_ENABLED=true
IDEMPOTENCY_TTL=86400  # 24 hours

# =============================================================================
# Queue Configuration
# =============================================================================
QUEUE_ENABLED=true
QUEUE_DEFAULT_TIMEOUT=600
QUEUE_RESULT_TTL=3600
QUEUE_FAILURE_TTL=86400

# =============================================================================
# Feature Flags
# =============================================================================
FEATURE_FLAG_CACHE_ENABLED=true
FEATURE_FLAG_REFRESH_INTERVAL=60

# =============================================================================
# AI Observability
# =============================================================================
DRIFT_DETECTION_ENABLED=true
DRIFT_DETECTION_INTERVAL=3600
BIAS_MONITORING_ENABLED=true
BIAS_MONITORING_THRESHOLD=0.8
